<div class="container-fluid">
  <div class="row align-items-start">

    <!-- 検索フォーム -->
    <div class="col-12">
      <div class="d-flex justify-content-center mb-4">
        <%= form_with url: search_posts_path, method: :get, local: true, class: 'form-inline' do %>
          <%= select_tag :search_type, options_for_select({ 'ユーザー名': 'name', '投稿内容': 'caption' }), class: 'form-control mr-sm-2' %>
          <%= text_field_tag :keyword, params[:keyword], placeholder: '検索...', class: 'form-control mr-sm-2' %>
          <%= submit_tag '検索', class: 'btn btn-outline-success my-2 my-sm-0' %>
        <% end %>
      </div>
    </div>

    <!-- サイドバー用のプロフィール -->
    <div class="col-lg-4 col-md-5">
      <%= render 'layouts/sidebar', user: @user %>
    </div>

    <!-- 投稿内容 -->
    <div class="col-lg-8 col-md-7 post_card">
      <% @posts.each do |post| %>
        <div class="card mb-3 bg-transparent border-0 shadow-lg">
          <div class="card-body">
            <div class="mb-5 bg-white">
              <!-- 投稿内容の詳細 -->
              <div class="d-flex justify-content-between">
                <div class="d-flex align-items-center">
                  <%= image_tag post.user.get_profile_image(30,30), size: "50x50", class: "rounded-circle mr-2" %>
                  <div>
                    <strong><%= post.user.name %></strong>
                    <p><small class="text-muted"><%= post.user.followers.count %> フォロワー</small></p>
                  </div>
                </div>
                <% unless post.user == current_user %>
                  <% if current_user.following?(post.user) %>
                    <%= link_to 'フォロー解除', unfollow_user_path(post.user.id), method: :delete, class: "btn btn-outline-primary btn-sm" %>
                  <% else %>
                    <%= link_to 'フォローする', follow_user_path(post.user.id), method: :post, class: "btn btn-outline-primary btn-sm" %>
                  <% end %>
                <% end %>
              </div>
                <%= link_to post_path(post) do %>
                  <%= image_tag post.get_resized_image(1000, 1000), class: "card-img-top" %>
                <% end %>
              <div class="card-body">
                <div class="d-flex">
                  <% favorite = post.favorites.find_by(user_id: current_user.id) %>
                  <% if favorite %>
                    <%= link_to favorite_path(favorite), method: :delete, class: "btn btn-outline-danger btn-sm mr-2" do %>
                      <i class="fas fa-heart"></i> いいね解除
                    <% end %>
                  <% else %>
                    <%= link_to favorites_path(post_id: post.id), method: :post, class: "btn btn-outline-danger btn-sm mr-2" do %>
                      <i class="fas fa-heart"></i> いいね
                    <% end %>
                  <% end %>
                  <span class="mr-2"><%= post.favorites.count %> いいね</span>
                  <span><%= post.comments.count %> コメント</span>
                </div>
                <p class="card-text mt-2"><%= post.caption %></p>
              </div>
            </div>
          </div>
        </div>
      <% end %>
      <%= paginate @posts %>
    </div>
  </div>
</div>